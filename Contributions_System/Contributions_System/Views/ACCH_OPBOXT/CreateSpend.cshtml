@model  Spend.Models.Helper.AcchOpBoxModelView

@{
    ViewBag.Title = "ترصيد للمشروع";

}



<div class="dashboard-content-wrap">
    <div class="dashboard-bread dashboard--bread dashboard-bread-2">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="breadcrumb-content">
                        <div class="section-heading">
                            <h2 class="sec__title font-size-30 text-white">عملية جديدة </h2>
                        </div>
                    </div><!-- end breadcrumb-content -->
                </div><!-- end col-lg-6 -->
                <div class="col-lg-6">
                    <div class="breadcrumb-list text-right">
                        <ul class="list-items">
                            <li><a href="~" class="text-white">الصفحة الرئيسية</a></li>
                            <li>المساهمة</li>
                            <li>انشاء عملية صرف للمشروع</li>

                        </ul>
                    </div><!-- end breadcrumb-list -->
                </div><!-- end col-lg-6 -->
            </div><!-- end row -->
        </div>
    </div><!-- end dashboard-bread -->
    <div class="dashboard-main-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-box">
                        <div class="form-title-wrap">
                            <div>
                                <h3 class="title">  عملية صرف للمشروع</h3>

                            </div>



                        </div>
                        <div class="form-content">

                            @using (Html.BeginForm())
                            {
                                @Html.AntiForgeryToken()
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })


                                <div class="row mb-3">

                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <label for="inputLastName">اسم المشروع</label>
                                            <select id="ProjectId" name="ProjectId" dir="ltr" class="form-control selectpicker " data-live-search="true" required onchange="GetAccCenterForProj()">
                                                @foreach (var p in ViewBag.proj)
                                                {
                                                    if (Model.ProjectId == p.ID)
                                                    {
                                                        <option class="themeprimary" value="@p.ID" selected> @p.PROJECT_AR_NAME</option>
                                                    }
                                                    else
                                                    {
                                                        <option class="themeprimary" value="@p.ID"> @p.PROJECT_AR_NAME</option>
                                                    }

                                                }

                                            </select>

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <label for="inputLastName">الصندوق</label>
                                            <select id="BoxId" name="BoxId" dir="ltr" class="form-control selectpicker " data-live-search="true">
                                                @foreach (var p in ViewBag.Box)
                                                {
                                                    try
                                                    {
                                                        if (Model.BoxId == p.BOX_NO)
                                                        {
                                                        <option class="themeprimary" value="@p.BOX_NO"selected> @p.BOX_NAME</option>
                                                        }
                                                        else
                                                        { <option class="themeprimary" value="@p.BOX_NO"> @p.BOX_NAME</option>}
                                                    }
                                                    catch { }
                                                }

                                            </select>

                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <label for="inputLastName">نوع العملية</label>
                                            <select id="OpTypeId" name="OpTypeId" dir="ltr" class="form-control selectpicker " data-live-search="true" required>
                                                <option value="">اختار نوع العملية </option>
                                                @foreach (var p in ViewBag.BOX_OP)
                                                {
                                                    if (p.OP_NO == 3 || p.OP_NO == 5 || p.OP_NO == 7)
                                                    {
                                                        if (Model.OpTypeId == p.OP_NO)
                                                        {
                                                            <option class="themeprimary" value="@p.OP_NO" selected> @p.OP_NAME</option>
                                                        }
                                                        else
                                                        {
                                                            <option class="themeprimary" value="@p.OP_NO"> @p.OP_NAME</option>
                                                        }
                                                    }
                                                }


                                            </select>

                                        </div>
                                    </div>


                                </div>

                                <div class="row mb-3">

                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <label for="inputLastName">نوع حدث العملية</label>
                                            <select id="OpActionTypeId" name="OpActionTypeId" dir="ltr" class="form-control selectpicker " data-live-search="true">
                                                <option value="">اختار نوع العملية </option>
                                                @foreach (var p in ViewBag.OPBOX_ACTIONS)
                                                {
                                                    if (p.ID == 4 || p.ID == 1 || p.ID == 6)
                                                    {
                                                        if (Model.OpActionTypeId == p.ID)
                                                        {
                                                            <option class="themeprimary" value="@p.ID" selected> @p.ACTION_NAME</option>
                                                        }
                                                        else
                                                        {
                                                            <option class="themeprimary" value="@p.ID"> @p.ACTION_NAME</option>
                                                        }
                                                    }
                                                }

                                            </select>

                                        </div>
                                    </div>





                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <label for="inputLastName"> التاريخ</label>
                                            @{
                                                string Date = "";
                                                try { Date = Model.Date.ToString("yyyy-MM-dd"); } catch { }


                                            }
                                            <input type="date" class="form-control" id="Date" value="@Date" name="Date">
                                            @Html.ValidationMessageFor(model => model.Date, "", new { @class = "text-danger" })

                                          
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <label for="inputLastName">المبلغ</label>
                                            @Html.EditorFor(model => model.TotalAmount, new { htmlAttributes = new { @class = "form-control", @type = "number", @placeholder = "المبلغ", @disabled = "disabled" } })
                                            @Html.ValidationMessageFor(model => model.TotalAmount, "", new { @class = "text-danger" })


                                        </div>
                                    </div>


                                </div>

                                <div class="row mb-3">

                                 

                                    <div class="col-md-12">
                                        <div class="form-floating">
                                            <label for="inputLastName">البيان</label>
                                            @Html.EditorFor(model => model.NOTE, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "البيان" } })
                                            @Html.ValidationMessageFor(model => model.NOTE, "", new { @class = "text-danger" })


                                        </div>
                                    </div>

                                </div>


                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10">
                                        <button type="button" id="addAccholder" class="btn btn-primary">اضافة مساهم</button>
                                       
                                    </div>
                                </div>


                                <div class="row mb-0">
                                    <div class="col-md-12">

                                        <div class="form-check form-switch col-md-12 p-0 ">
                                            <div class="card mb-4 col-md-12  ">

                                                <div class="card-body">
                                                    <table id="parent-table" class="table  table-bordered">
                                                        <thead>
                                                            <tr>


                                                                <th>المساهم</th>
                                                                <th>اجمالي الرصيد</th>
                                                                <th>نوع المساهمة</th>
                                                                <th>نسبة المساهمة</th>
                                                                <th>الرصيد المستقطع</th>
                                                                <th>الرصيد المتبقي</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="opBoxlist">
                                                            @for (int i = 0; i < Model.AcchOpBoxDetailsModelView.Count; i++)
                                                            {
                                                              

                                                                    <tr class="form-group">
                                                                    <td>
                                                                        <select id="AcchOpBoxDetailsModelView[@i]_AccHolderId" name="AcchOpBoxDetailsModelView[@i].AccHolderI" dir="ltr" class="form-control selectpicker " data-live-search="true">
                                                                            <option value="">اختار المساهم </option>
                                                                            @foreach (var p in ViewBag.Holder)
                                                                            {
                                                                               
                                                                                    if (Model.AcchOpBoxDetailsModelView[i].AccHolderId == p.ACC_HOLDER_NO)
                                                                                    {
                                                                                        <option class="themeprimary" value="@p.ACC_HOLDER_NO" selected> @p.ACC_HOLDER_NAME</option>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <option class="themeprimary" value="@p.ACC_HOLDER_NO"> @p.ACC_HOLDER_NAME</option>
                                                                                    }
                                                                                
                                                                            }

                                                                        </select>

                                                                        

                                                                    </td>
                                                                    <td id="AcchOpBoxDetailsModelView[@i]_BeforBalence" > </td>
                                                                    <td>@Model.AcchOpBoxDetailsModelView[i].IsPercentage </td>
                                                                    <td>@Model.AcchOpBoxDetailsModelView[i].percentage</td>
                                                                    <td>
                                                                        @Html.EditorFor(model => Model.AcchOpBoxDetailsModelView[i].Amount, new { htmlAttributes = new { @class = "form-control", @type = "number" } })
                                                                        @Html.ValidationMessageFor(model => model.NOTE, "", new { @class = "text-danger" })


                                                                    </td>
                                                                    <td id="AcchOpBoxDetailsModelView[@i]_NetBalence"> </td>
                                                                    <td>
                                                                        <button type="button" class="btn btn-danger removeB">حذف</button>
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>

                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-4 mb-0">
                                    <div class="d-grid col-md-6 "><button class="btn btn-primary btn-block" type="submit">حفظ</button></div>

                                    <div class="d-grid col-md-6"><a class="btn btn-danger btn-block" href="~/ACCH_OPBOXT/SpendProsses">رجوع</a></div>


                                </div>




                            }

                        </div>
                    </div><!-- end form-box -->
                </div><!-- end col-lg-12 -->
            </div><!-- end row -->

            <div class="border-top mt-5"></div>
            <div class="row align-items-center">
                <div class="col-lg-7">
                    <div class="copy-right padding-top-30px">

                        <p class="copy__desc">
                            &copy; Copyright Tech Light 2022. Made with
                            <span class="la la-heart"></span> by <a href="http://TechLightsa.com/">Noury</a>
                        </p>

                    </div><!-- end copy-right -->
                </div><!-- end col-lg-7 -->
                <div class="col-lg-5">
                    <div class="footer-social-box text-right padding-top-30px">
                        <ul class="social-profile">
                            <li><a href="#"><i class="lab la-facebook-f"></i></a></li>
                            <li><a href="#"><i class="lab la-twitter"></i></a></li>
                            <li><a href="#"><i class="lab la-instagram"></i></a></li>
                            <li><a href="#"><i class="lab la-linkedin-in"></i></a></li>
                        </ul>
                    </div><!-- end copy-right-content -->
                </div><!-- end col-lg-5 -->
            </div><!-- end row -->
        </div><!-- end container-fluid -->
    </div><!-- end dashboard-main-content -->
</div><!-- end dashboard-content-wrap -->
<script>
    $(document).ready(function () {
        var index = @Model.AcchOpBoxDetailsModelView.Count;

        $('#addAccholder').click(function () {
            var newItem = ` <tr class="form-group">
      <td>
      <select id="AcchOpBoxDetailsModelView_${index}_AccHolderId" name="AcchOpBoxDetailsModelView[${index}].AccHolderI" dir="ltr" class="form-control selectpicker " data-live-search="true">
          <option value="">اختار المساهم </option>
          @foreach (var p in ViewBag.Holder)
          {


              <option class="themeprimary" value="@p.ACC_HOLDER_NO"> @p.ACC_HOLDER_NAME</option>


          }

      </select>



    </td>
       <td id="AcchOpBoxDetailsModelView[${index}]_BeforBalence" > </td>
     <td>item.IsPercentage </td>
     <td>item.percentage</td>
     <td> <input class="form-control" type="number" name="AcchOpBoxDetailsModelView[${index}].Amount" id="AcchOpBoxDetailsModelView_${index}__Amount" /> </td>
      <td id="AcchOpBoxDetailsModelView[${index}]_NetBalence"> </td>
     <td> <button type="button" class="btn btn-danger removeB">Delete</button></td>
      </tr>`;
             $('#opBoxlist').append(newItem);
            var select = $('#AcchOpBoxDetailsModelView_' + index + '_AccHolderId');
            select.selectpicker(); // Initialize the selectpicker
            select.selectpicker('refresh'); // Refresh the selectpicker
            index++;
        });




        $('#opBoxlist').on('click', '.removeB', function () {
            $(this).closest('.form-group').remove();
        });
    });
</script>





